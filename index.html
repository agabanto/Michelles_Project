<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Michelle Nair's Party Run Sheets</title>
    <link rel="icon" type="image/png" href="fav-icon.png">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <script src="https://unpkg.com/docx@8.4.0/build/index.umd.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
    <script src="https://unpkg.com/docx@8.4.0/build/index.umd.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
    <link href="https://fonts.googleapis.com/css2?family=Inter&display=swap" rel="stylesheet">
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.9.1/firebase-app.js";
        import { getFirestore, collection, addDoc } from "https://www.gstatic.com/firebasejs/11.9.1/firebase-firestore.js";
        import { getAnalytics } from "https://www.gstatic.com/firebasejs/11.9.1/firebase-analytics.js";

        const firebaseConfig = {
            apiKey: "AIzaSyAbY1J9Spm8kSOg3VKCxRPS2jv3wlExG_4",
            authDomain: "runsheet-9e616.firebaseapp.com",
            projectId: "runsheet-9e616",
            storageBucket: "runsheet-9e616.firebasestorage.app",
            messagingSenderId: "484666242180",
            appId: "1:484666242180:web:147f3ec233f4fb0f483ed1",
            measurementId: "G-9QF9XW65T0"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const analytics = getAnalytics(app);

        window.db = db;
        window.firestore = { collection, addDoc };
    </script>
    <style>
        @keyframes slide-in {
            from {
                transform: translateX(100%);
                opacity: 0;
            }

            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .animate-slide-in {
            animation: slide-in 0.3s ease-out;
        }
    </style>
</head>

<body class="p-8 font-sans text-gray-800 text-sm" style="
    font-family: 'Inter', sans-serif;
    background-image: url('blob-scene-haikei.svg');
    background-size: cover;
    background-repeat: no-repeat;
    background-position: center;
    background-attachment: fixed;">

    <!-- Logo for small screens (shown only on mobile) -->
    <div class="w-full flex justify-center mb-4 md:hidden">
        <img src="logo-white.png" alt="Michelle Nair's Party Run Sheets Logo" class="h-40 transition duration-300 transform hover:scale-105 hover:drop-shadow-lg object-contain" draggable="false"/>
    </div>

    <div class="max-w-7xl mx-auto flex flex-col md:flex-row-reverse gap-8 items-start">
        <div class="w-full md:w-[800px] mx-auto bg-white p-8 rounded-lg shadow-lg space-y-8">
            <div class="text-center mb-10 space-y-2">
                <h1 id="form-title" class="text-4xl font-extrabold text-purple-800 tracking-tight">
                    New Form
                </h1>
                <p id="form-subtitle" class="text-sm text-gray-500">Michelle Nair’s Party Run Sheet</p>
                <div class="h-1 w-16 bg-purple-400 mx-auto rounded-full"></div>
            </div>

            <div class="space-y-4">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label for="host" class="block mb-1 font-bold">Host Name(s)</label>
                        <input type="text" id="host" placeholder="e.g. Michelle, Jordan"
                            class="w-full border p-3 rounded" />
                    </div>
                    <div>
                        <label for="date" class="block mb-1 font-bold">Party Date</label>
                        <input type="date" id="date" class="w-full border p-3 rounded" />
                    </div>

                    <div>
                        <label for="birthday-child" class="block mb-1 font-bold">Birthday Child(ren)</label>
                        <input type="text" id="birthday-child" placeholder="e.g. Ava, Leo"
                            class="w-full border p-3 rounded" />
                    </div>
                    <div>
                        <label for="age" class="block mb-1 font-bold">Age(s)</label>
                        <input type="text" id="age" placeholder="e.g. 5, 7" class="w-full border p-3 rounded" />
                    </div>

                    <div>
                        <label for="parent-name" class="block mb-1 font-bold">Parent Name(s)</label>
                        <input type="text" id="parent-name" placeholder="e.g. Sarah, Alex"
                            class="w-full border p-3 rounded" />
                    </div>
                    <div>
                        <label for="guests" class="block mb-1 font-bold">Number of Guests</label>
                        <input type="number" id="guests" min="1" placeholder="e.g. 12"
                            class="w-full border p-3 rounded" />
                    </div>
                </div>
            </div>

            <hr class="my-6 border-t">
            <div class="mt-4">
                <label class="block mb-2 font-bold">Select a Package</label>
                <select id="partypkg" class="w-full border p-3 rounded">
                    <option value="" disabled selected hidden>-- Select Package --</option>

                    <optgroup label="Kids Packages">
                        <option value="Kids Bronze">Kids Bronze</option>
                        <option value="Kids Silver">Kids Silver</option>
                        <option value="Kids Gold">Kids Gold</option>
                        <option value="Kids Platinum">Kids Platinum</option>
                    </optgroup>

                    <optgroup label="Teens Packages">
                        <option value="Teens Silver">Teens Silver</option>
                        <option value="Teens Gold">Teens Gold</option>
                    </optgroup>
                </select>
            </div>

            <div id="extra-fields"
                class="mt-6 space-y-4 opacity-50 pointer-events-none transition-opacity duration-300">
                <div class="flex gap-4">
                    <div id="food-section" class="flex-1">
                        <label for="food" class="block mb-1 font-bold">Food Selection (choose multiple)</label>
                        <div class="border p-3 rounded h-64 overflow-y-auto space-y-2">
                            <label class="flex items-center justify-between">
                                <div>
                                    <input type="checkbox" name="food" value="BBQ Meatlovers Pizza" class="mr-2"
                                        onchange="togglePlatterInput(this)">
                                    BBQ Meatlovers Pizza
                                </div>
                                <input type="number" name="platters-BBQ_Meatlovers_Pizza" min="1" placeholder="0"
                                    class="w-16 border rounded p-1 hidden" />
                            </label>

                            <label class="flex items-center justify-between">
                                <div>
                                    <input type="checkbox" name="food" value="Crispy Chicken Tacos" class="mr-2"
                                        onchange="togglePlatterInput(this)">
                                    Crispy Chicken Tacos
                                </div>
                                <input type="number" name="platters-Crispy_Chicken_Tacos" min="1" placeholder="0"
                                    class="w-16 border rounded p-1 hidden" />
                            </label>

                            <label class="flex items-center justify-between">
                                <div>
                                    <input type="checkbox" name="food" value="Crispy Prawn Tacos" class="mr-2"
                                        onchange="togglePlatterInput(this)">
                                    Crispy Prawn Tacos
                                </div>
                                <input type="number" name="platters-Crispy_Prawn_Tacos" min="1" placeholder="0"
                                    class="w-16 border rounded p-1 hidden" />
                            </label>

                            <label class="flex items-center justify-between">
                                <div>
                                    <input type="checkbox" name="food" value="Haloumi Chips" class="mr-2"
                                        onchange="togglePlatterInput(this)">
                                    Haloumi Chips
                                </div>
                                <input type="number" name="platters-Haloumi_Chips" min="1" placeholder="0"
                                    class="w-16 border rounded p-1 hidden" />
                            </label>

                            <label class="flex items-center justify-between">
                                <div>
                                    <input type="checkbox" name="food" value="Margherita Pizza (V)" class="mr-2"
                                        onchange="togglePlatterInput(this)">
                                    Margherita Pizza (V)
                                </div>
                                <input type="number" name="platters-Margherita_Pizza_V" min="1" placeholder="0"
                                    class="w-16 border rounded p-1 hidden" />
                            </label>

                            <label class="flex items-center justify-between">
                                <div>
                                    <input type="checkbox" name="food" value="New York Beef Sliders w/ Cheese"
                                        class="mr-2" onchange="togglePlatterInput(this)">
                                    New York Beef Sliders w/ Cheese
                                </div>
                                <input type="number" name="platters-New_York_Beef_Sliders_w_Cheese" min="1"
                                    placeholder="0" class="w-16 border rounded p-1 hidden" />
                            </label>

                            <label class="flex items-center justify-between">
                                <div>
                                    <input type="checkbox" name="food" value="Pork Belly Sliders" class="mr-2"
                                        onchange="togglePlatterInput(this)">
                                    Pork Belly Sliders
                                </div>
                                <input type="number" name="platters-Pork_Belly_Sliders" min="1" placeholder="0"
                                    class="w-16 border rounded p-1 hidden" />
                            </label>

                            <label class="flex items-center justify-between">
                                <div>
                                    <input type="checkbox" name="food" value="Potato Bar" class="mr-2"
                                        onchange="togglePlatterInput(this)">
                                    Potato Bar
                                </div>
                                <input type="number" name="platters-Potato_Bar" min="1" placeholder="0"
                                    class="w-16 border rounded p-1 hidden" />
                            </label>

                            <label class="flex items-center justify-between">
                                <div>
                                    <input type="checkbox" name="food" value="Prawn Spring Rolls" class="mr-2"
                                        onchange="togglePlatterInput(this)">
                                    Prawn Spring Rolls
                                </div>
                                <input type="number" name="platters-Prawn_Spring_Rolls" min="1" placeholder="0"
                                    class="w-16 border rounded p-1 hidden" />
                            </label>

                            <label class="flex items-center justify-between">
                                <div>
                                    <input type="checkbox" name="food" value="Pulled Beef Brisket Slider" class="mr-2"
                                        onchange="togglePlatterInput(this)">
                                    Pulled Beef Brisket Slider
                                </div>
                                <input type="number" name="platters-Pulled_Beef_Brisket_Slider" min="1" placeholder="0"
                                    class="w-16 border rounded p-1 hidden" />
                            </label>

                            <label class="flex items-center justify-between">
                                <div>
                                    <input type="checkbox" name="food" value="Salt and Szechuan Pepper Squid"
                                        class="mr-2" onchange="togglePlatterInput(this)">
                                    Salt and Szechuan Pepper Squid
                                </div>
                                <input type="number" name="platters-Salt_and_Szechuan_Pepper_Squid" min="1"
                                    placeholder="0" class="w-16 border rounded p-1 hidden" />
                            </label>

                            <label class="flex items-center justify-between">
                                <div>
                                    <input type="checkbox" name="food" value="Smoked Ham & Three Cheese Pizza"
                                        class="mr-2" onchange="togglePlatterInput(this)">
                                    Smoked Ham & Three Cheese Pizza
                                </div>
                                <input type="number" name="platters-Smoked_Ham_and_Three_Cheese_Pizza" min="1"
                                    placeholder="0" class="w-16 border rounded p-1 hidden" />
                            </label>

                            <label class="flex items-center justify-between">
                                <div>
                                    <input type="checkbox" name="food" value="Southern Fried Chicken Bites" class="mr-2"
                                        onchange="togglePlatterInput(this)">
                                    Southern Fried Chicken Bites
                                </div>
                                <input type="number" name="platters-Southern_Fried_Chicken_Bites" min="1"
                                    placeholder="0" class="w-16 border rounded p-1 hidden" />
                            </label>

                            <label class="flex items-center justify-between">
                                <div>
                                    <input type="checkbox" name="food" value="Southern Fried Chicken Burgers"
                                        class="mr-2" onchange="togglePlatterInput(this)">
                                    Southern Fried Chicken Burgers
                                </div>
                                <input type="number" name="platters-Southern_Fried_Chicken_Burgers" min="1"
                                    placeholder="0" class="w-16 border rounded p-1 hidden" />
                            </label>

                            <label class="flex items-center justify-between">
                                <div>
                                    <input type="checkbox" name="food" value="Tempura Prawns w/ Wasabi Mayo"
                                        class="mr-2" onchange="togglePlatterInput(this)">
                                    Tempura Prawns w/ Wasabi Mayo
                                </div>
                                <input type="number" name="platters-Tempura_Prawns_w_Wasabi_Mayo" min="1"
                                    placeholder="0" class="w-16 border rounded p-1 hidden" />
                            </label>

                            <label class="flex items-center justify-between">
                                <div>
                                    <input type="checkbox" name="food" value="Tokyo Style Chicken Skewers" class="mr-2"
                                        onchange="togglePlatterInput(this)">
                                    Tokyo Style Chicken Skewers
                                </div>
                                <input type="number" name="platters-Tokyo_Style_Chicken_Skewers" min="1" placeholder="0"
                                    class="w-16 border rounded p-1 hidden" />
                            </label>

                            <label class="flex items-center justify-between">
                                <div>
                                    <input type="checkbox" name="food" value="Vege Stack Sliders" class="mr-2"
                                        onchange="togglePlatterInput(this)">
                                    Vege Stack Sliders
                                </div>
                                <input type="number" name="platters-Vege_Stack_Sliders" min="1" placeholder="0"
                                    class="w-16 border rounded p-1 hidden" />
                            </label>

                            <label class="flex items-center justify-between">
                                <div>
                                    <input type="checkbox" name="food" value="Vegetarian Spring Rolls" class="mr-2"
                                        onchange="togglePlatterInput(this)">
                                    Vegetarian Spring Rolls
                                </div>
                                <input type="number" name="platters-Vegetarian_Spring_Rolls" min="1" placeholder="0"
                                    class="w-16 border rounded p-1 hidden" />
                            </label>
                        </div>
                    </div>

                    <div class="w-1/3 min-w-[160px]">
                        <label for="gift" class="block mb-1 font-bold">Gift Selection</label>
                        <select id="gift" class="w-full border p-3 rounded">
                            <option value="" disabled selected hidden>-- Choose Gift --</option>
                            <option value="Stickers">Small Plush</option>
                            <option value="Toys">Mega Plush</option>
                        </select>
                    </div>
                </div>
            </div>

            <hr class="my-6 border-t">
            <div class="mt-8">
                <h2 class="text-lg font-semibold mb-3">Party Schedule</h2>
                <div id="timeline" class="space-y-2">
                    <table class="w-full border border-collapse">
                        <thead>
                            <tr>
                                <th class="border px-3 py-2 bg-gray-100 text-left">Activity</th>
                                <th class="border px-3 py-2 bg-gray-100 text-left">Time</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr id="extra-row-1">
                                <td class="border px-3 py-2">
                                    <select id="extra-activity-1" class="w-full border p-2 rounded">
                                        <option value="" disabled selected hidden>-- Extra Activity 1 --</option>
                                        <option value="Bonus Arcade Time">Bonus Arcade Time</option>
                                        <option value="Bowling">Bowling</option>
                                        <option value="Darts">Darts</option>
                                        <option value="Escape Room">Escape Room</option>
                                        <option value="Karaoke">Karaoke</option>
                                        <option value="Laser Tag">Laser Tag</option>
                                    </select>
                                </td>
                                <td class="border px-3 py-2">
                                    <input type="time" id="extra-time-1" class="w-full border p-2 rounded">
                                </td>
                            </tr>
                            <tr id="extra-row-2">
                                <td class="border px-3 py-2">
                                    <select id="extra-activity-2" class="w-full border rounded p-2">
                                        <option value="" disabled selected hidden>-- Extra Activity 2 --</option>
                                        <option value="Bonus Arcade Time">Bonus Arcade Time</option>
                                        <option value="Bowling">Bowling</option>
                                        <option value="Darts">Darts</option>
                                        <option value="Escape Room">Escape Room</option>
                                        <option value="Karaoke">Karaoke</option>
                                        <option value="Laser Tag">Laser Tag</option>
                                    </select>
                                </td>
                                <td class="border px-3 py-2">
                                    <input type="time" id="extra-time-2" class="w-full border rounded p-2">
                                </td>
                            </tr>
                            <tr>
                                <td class="border px-3 py-2">Mid Party Snack</td>
                                <td class="border px-3 py-2">
                                    <input type="time" id="snack-time" class="w-full border rounded p-2">
                                </td>
                            </tr>
                            <tr>
                                <td class="border px-3 py-2">Throne</td>
                                <td class="border px-3 py-2">
                                    <input type="time" id="throne-time" class="w-full border rounded p-2">
                                </td>
                            </tr>
                            <tr>
                                <td class="border px-3 py-2">Arcade</td>
                                <td class="border px-3 py-2">
                                    <input type="time" id="arcade-time" class="w-full border rounded p-2">
                                </td>
                            </tr>
                            <tr>
                                <td class="border px-3 py-2">Winners Vault</td>
                                <td class="border px-3 py-2">
                                    <input type="time" id="winners-time" class="w-full border rounded p-2">
                                </td>
                            </tr>
                            <tr>
                                <td class="border px-3 py-2">Food & Cake</td>
                                <td class="border px-3 py-2">
                                    <input type="time" id="cake-time" class="w-full border rounded p-2">
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        <div class="w-full md:w-64 md:sticky md:top-8 self-start">
            <div class="w-full flex items-center justify-center md:w-64 md:sticky md:top-8 self-start">
                <img src="logo-white.png" alt="Michelle Nair's Party Run Sheets Logo"
                    class="h-30 object-contain transition duration-300 transform hover:scale-105 hover:drop-shadow-lg hidden md:block" draggable="false"/>
            </div>
            <div class="bg-white p-4 rounded-lg shadow-lg space-y-4">
                <!-- Buttons go here -->
                <button type="button" onclick="generateEventDocx(getFormData())"
                    class="w-full flex items-center justify-center gap-2 bg-blue-600 hover:bg-blue-700 text-white px-5 py-2.5 rounded shadow transition">
                    <i class="fas fa-file-word text-lg"></i> Word Doc
                </button>

                <button type="button" onclick="generateEventPDF(getFormData())"
                    class="w-full flex items-center justify-center gap-2 bg-red-600 hover:bg-red-700 text-white px-5 py-2.5 rounded shadow transition">
                    <i class="fas fa-file-pdf text-lg"></i> PDF
                </button>

                <button id="save-btn" onclick="handleSave()"
                    class="w-full flex items-center justify-center gap-2 bg-green-600 hover:bg-green-700 text-white px-5 py-2.5 rounded shadow transition">
                    <i class="fas fa-save text-lg"></i> Save Form
                </button>

                <button onclick="openMyForms()"
                    class="w-full flex items-center justify-center gap-2 bg-purple-600 hover:bg-purple-700 text-white px-5 py-2.5 rounded shadow transition">
                    <i class="fas fa-folder-open text-lg"></i> My Forms
                </button>

                <button onclick="handleNewForm()"
                    class="w-full flex items-center justify-center gap-2 bg-gray-600 hover:bg-gray-700 text-white px-5 py-2.5 rounded shadow transition">
                    <i class="fas fa-plus-circle text-lg"></i> New Form
                </button>
            </div>
        </div>
    </div>

    <script>
        document.getElementById("partypkg").addEventListener("change", function () {
            const selected = this.value;

            const row1 = document.getElementById("extra-row-1");
            const row2 = document.getElementById("extra-row-2");

            const foodSection = document.getElementById("food-section");
            const gift = document.getElementById("gift");
            const activity1 = document.getElementById("extra-activity-1");
            const time1 = document.getElementById("extra-time-1");
            const activity2 = document.getElementById("extra-activity-2");
            const time2 = document.getElementById("extra-time-2");

            const extraFields = document.getElementById("extra-fields");
            const allTimeInputs = document.querySelectorAll("input[type='time']");
            const allActivitySelects = document.querySelectorAll("select[id^='extra-activity']");

            if (selected) {
                // Enable food, gift, extra activity 1 and time fields
                foodSection.classList.remove("opacity-50", "pointer-events-none");
                gift.disabled = false;
                activity1.disabled = false;
                time1.disabled = false;
                extraFields.classList.remove("opacity-50", "pointer-events-none");
                allTimeInputs.forEach(input => input.disabled = false);
                allActivitySelects.forEach(select => select.disabled = false);
            } else {
                // Disable everything if no package is selected
                foodSection.classList.add("opacity-50", "pointer-events-none");
                gift.disabled = true;
                activity1.disabled = true;
                time1.disabled = true;
                activity2.disabled = true;
                time2.disabled = true;
                extraFields.classList.add("opacity-50", "pointer-events-none");
                allTimeInputs.forEach(input => input.disabled = true);
                allActivitySelects.forEach(select => select.disabled = true);
            }

            // Logic for whether to show Extra Activity 2
            const twoActivities = ["Kids Gold", "Kids Platinum", "Teens Gold"];
            row2.style.display = twoActivities.includes(selected) ? "" : "none";
        });

        // Re-check on page load
        window.addEventListener("DOMContentLoaded", () => {
            document.getElementById("partypkg").dispatchEvent(new Event("change"));
        });

        function togglePlatterInput(checkbox) {
            const numberInput = checkbox.parentElement.parentElement.querySelector('input[type="number"]');
            if (checkbox.checked) {
                numberInput.classList.remove('hidden');
            } else {
                numberInput.classList.add('hidden');
                numberInput.value = ''; // Clear value when unchecked
            }
        }

        function createCell(label, value = "") {
            return new docx.TableCell({
                children: [new docx.Paragraph({
                    children: [
                        new docx.TextRun({ text: label + " ", bold: true }),
                        new docx.TextRun({ text: value })
                    ]
                })],
                margins: { top: 100, bottom: 100, left: 100, right: 100 },
                width: { size: 33.3, type: "pct" }
            });
        }

        function getFormData() {

            const foodSelections = Array.from(document.querySelectorAll('input[name="food"]:checked')).map(cb => {
                const food = cb.value;
                const input = cb.closest('label').querySelector('input[type="number"]');
                const quantity = input && input.value ? parseInt(input.value) : 0;
                return quantity > 0 ? `${quantity}x ${food}` : null;
            }).filter(item => item !== null);

            return {
                host: document.getElementById("host").value,
                date: document.getElementById("date").value,
                birthdayChild: document.getElementById("birthday-child").value,
                parentName: document.getElementById("parent-name").value,
                age: document.getElementById("age").value,
                guests: document.getElementById("guests").value,
                partypkg: document.getElementById("partypkg").value,
                food: foodSelections.join(", "),
                gift: document.getElementById("gift").value,
                activity1: document.getElementById("extra-activity-1").value,
                time1: document.getElementById("extra-time-1").value,
                activity2: document.getElementById("extra-activity-2").value,
                time2: document.getElementById("extra-time-2").value,
                snackTime: document.getElementById("snack-time").value,
                throneTime: document.getElementById("throne-time").value,
                arcadeTime: document.getElementById("arcade-time").value,
                winnersTime: document.getElementById("winners-time").value,
                cakeTime: document.getElementById("cake-time").value
            };
        }

        function populateForm(data) {
            document.getElementById("host").value = data.host || "";
            document.getElementById("date").value = data.date || "";
            document.getElementById("birthday-child").value = data.birthdayChild || "";
            document.getElementById("age").value = data.age || "";
            document.getElementById("parent-name").value = data.parentName || "";
            document.getElementById("guests").value = data.guests || "";
            document.getElementById("partypkg").value = data.partypkg || "";
            document.getElementById("gift").value = data.gift || "";
            document.getElementById("extra-activity-1").value = data.activity1 || "";
            document.getElementById("extra-time-1").value = data.time1 || "";
            document.getElementById("extra-activity-2").value = data.activity2 || "";
            document.getElementById("extra-time-2").value = data.time2 || "";
            document.getElementById("snack-time").value = data.snackTime || "";
            document.getElementById("throne-time").value = data.throneTime || "";
            document.getElementById("arcade-time").value = data.arcadeTime || "";
            document.getElementById("winners-time").value = data.winnersTime || "";
            document.getElementById("cake-time").value = data.cakeTime || "";

            // Re-check the package to re-enable fields
            document.getElementById("partypkg").dispatchEvent(new Event("change"));

            // Re-check food checkboxes
            const foodArray = data.food ? data.food.split(",").map(f => f.trim()) : [];
            foodArray.forEach(entry => {
                const [qtyStr, ...labelParts] = entry.split("x");
                const qty = parseInt(qtyStr);
                const label = labelParts.join("x").trim();

                const checkbox = Array.from(document.querySelectorAll('input[name="food"]')).find(cb => cb.value === label);
                if (checkbox) {
                    checkbox.checked = true;
                    const input = checkbox.closest('label').querySelector('input[type="number"]');
                    if (input) {
                        input.classList.remove("hidden");
                        input.value = qty;
                    }
                }
            });

            // Change button text to "Update"
            const btn = document.getElementById("save-btn");
            if (btn) {
                btn.innerHTML = `<i class="fas fa-pen-to-square text-lg"></i> Update Form`;
            }

            const titleEl = document.getElementById("form-title");
            const sheetTitle = data.birthdayChild || data.host || "Unnamed";
            titleEl.textContent = sheetTitle;
            window.scrollTo({ top: 0, behavior: "smooth" });
        }

        function resetFormState() {
            currentFormId = null;
            const btn = document.getElementById("save-btn");
            if (btn) {
                btn.innerHTML = `
            <i class="fas fa-save text-lg"></i> Save Form
        `;
            }
        }

        let currentFormId = null;

        async function saveFormToFirestore(formData) {
            const db = window.db;
            const { collection, addDoc } = window.firestore;

            try {
                const docRef = await addDoc(collection(db, "runsheets"), formData);
                showToast("Form saved successfully", "success");
                currentFormId = docRef.id;
                document.getElementById("save-btn").innerHTML = `<i class="fas fa-pen-to-square text-lg"></i> Update Form`;

            } catch (e) {
                console.error("Error adding document: ", e);
                showToast("Failed to save form", "error");
            }
        }

        async function updateFormInFirestore(id, formData) {
            const db = window.db;
            const { doc, updateDoc } = await import("https://www.gstatic.com/firebasejs/11.9.1/firebase-firestore.js");

            // Add name explicitly in case your formData doesn't include it
            formData.name = formData.birthdayChild || formData.host || "Untitled";

            try {
                await updateDoc(doc(db, "runsheets", id), formData);
                showToast("Form updated", "success");
            } catch (e) {
                console.error("Error updating form:", e);
                showToast("Failed to update form", "error");
            }
        }

        async function handleSave() {
            const formData = getFormData();

            if (currentFormId) {
                // This is an update
                await updateFormInFirestore(currentFormId, formData);

                const titleEl = document.getElementById("form-title");
                const sheetTitle = formData.birthdayChild || formData.host || "Unnamed";
                titleEl.textContent = sheetTitle;

                // Refresh the My Forms list if it's visible
                if (document.getElementById("my-forms-modal")?.style.display === "block") {
                    openMyForms(); // Re-fetch and re-render list
                }

            } else {
                // This is a new save
                await saveFormToFirestore(formData);
                const titleEl = document.getElementById("form-title");
                const sheetTitle = formData.birthdayChild || formData.host || "Unnamed";
                titleEl.textContent = sheetTitle;
            }
        }

        async function generateEventPDF(formData) {
            const doc = await buildWordDocument(formData); // Extract your doc creation logic to this
            const blob = await window.docx.Packer.toBlob(doc);

            // Convert to PDF using Cloudmersive
            const formDataToSend = new FormData();
            formDataToSend.append("file", blob, "event.docx");

            try {
                const response = await axios.post(
                    "https://api.cloudmersive.com/convert/docx/to/pdf",
                    formDataToSend,
                    {
                        headers: {
                            "Content-Type": "multipart/form-data",
                            "Apikey": "4312a960-d69d-4887-b4f6-bed214a03992"
                        },
                        responseType: "blob" // Get binary PDF
                    }
                );

                // Save the PDF
                const pdfBlob = new Blob([response.data], { type: "application/pdf" });
                const namePart = (formData.birthdayChild || formData.host || "event").replace(/\s+/g, "_");
                const datePart = formData.date || "no-date";
                const filename = `${datePart}-${namePart}-runsheet.pdf`;
                window.saveAs(pdfBlob, filename)
            } catch (error) {
                console.error("Cloudmersive API error:", error);
                showToast("There was a problem converting the DOCX to PDF", "error");
            }
        }

        async function generateEventDocx(formData) {
            const doc = await buildWordDocument(formData);
            const blob = await window.docx.Packer.toBlob(doc);
            const namePart = (formData.birthdayChild || formData.host || "event").replace(/\s+/g, "_");
            const datePart = formData.date || "no-date";
            const filename = `${datePart}-${namePart}-runsheet.docx`;
            window.saveAs(blob, filename)
        }

        async function buildWordDocument(formData) {
            const {
                host,
                date,
                birthdayChild,
                age,
                parentName,
                guests,
                partypkg,
                food,
                gift,
                activity1,
                time1,
                activity2,
                time2,
                snackTime,
                throneTime,
                arcadeTime,
                winnersTime,
                cakeTime
            } = formData;

            const doc = new window.docx.Document({
                styles: {
                    default: {
                        document: {
                            run: {
                                font: "Calibri",
                                size: 20 // 14pt
                            }
                        }
                    }
                },
                numbering: {
                    config: [
                        {
                            reference: "checkbox-bullets",
                            levels: [
                                {
                                    level: 0,
                                    format: "bullet",
                                    text: "☐", // hollow square
                                    alignment: docx.AlignmentType.LEFT
                                }
                            ]
                        }
                    ]
                },
                sections: [
                    {
                        properties: {
                            page: {
                                margin: {
                                    top: 720,      // 0.5 inch
                                    right: 720,
                                    bottom: 720,
                                    left: 720
                                }
                            }
                        },
                        headers: {},
                        footers: {
                            default: new docx.Footer({
                                children: [
                                    new docx.Paragraph({
                                        alignment: docx.AlignmentType.CENTER,
                                        children: [
                                            new docx.TextRun({
                                                text: "ALWAYS STAY WITH YOUR PARTY",
                                                bold: true,
                                                color: "999999", // Soft grey to simulate transparency
                                                size: 28
                                            })
                                        ],
                                    })
                                ]
                            })
                        },
                        children: [

                            new docx.Table({
                                rows: [
                                    new docx.TableRow({
                                        children: [
                                            createCell("Host:", host),
                                            createCell("Birthday Child:", birthdayChild),
                                            createCell("Date:", date)
                                        ]
                                    }),
                                    new docx.TableRow({
                                        children: [
                                            createCell("Package:", partypkg),
                                            createCell("Age:", age),
                                            createCell("Parent Name:", parentName)
                                        ]
                                    }),
                                    new docx.TableRow({
                                        children: [
                                            createCell("No. of Guests:", guests),
                                            createCell("Table Number:", ""),
                                            createCell("Waiting Table:", "")
                                        ]
                                    }),
                                    new docx.TableRow({
                                        children: [
                                            createCell("Goodie Bags:", ""),
                                            createCell("GOH Gift:", gift),
                                            createCell("Lanyard Colour:", "")
                                        ]
                                    }),
                                    new docx.TableRow({
                                        children: [
                                            new docx.TableCell({
                                                children: [new docx.Paragraph({
                                                    children: [
                                                        new docx.TextRun({ text: "Extras: ", bold: true }),
                                                        new docx.TextRun({ text: formData.food })
                                                    ]
                                                })],
                                                columnSpan: 3,
                                                margins: { top: 100, bottom: 100, left: 100, right: 100 }
                                            })
                                        ]
                                    })
                                ],
                                width: { size: 100, type: "pct" },
                                borders: {
                                    top: { style: docx.BorderStyle.SINGLE, size: 4, color: "000000" },
                                    bottom: { style: docx.BorderStyle.SINGLE, size: 4, color: "000000" },
                                    left: { style: docx.BorderStyle.SINGLE, size: 4, color: "000000" },
                                    right: { style: docx.BorderStyle.SINGLE, size: 4, color: "000000" },
                                    insideHorizontal: { style: docx.BorderStyle.SINGLE, size: 4, color: "000000" },
                                    insideVertical: { style: docx.BorderStyle.SINGLE, size: 4, color: "000000" }
                                }
                            }),

                            new docx.Paragraph({ text: "", spacing: { after: 1 } }),

                            (() => {
                                const activityRow = [];
                                const timeRow = [];

                                // Prepare the dynamic parts
                                const dynamicActivities = [];
                                if (activity1 || time1) {
                                    dynamicActivities.push({
                                        activity: activity1 || "",
                                        time: time1 || ""
                                    });
                                }
                                if (activity2 || time2) {
                                    dynamicActivities.push({
                                        activity: activity2 || "",
                                        time: time2 || ""
                                    });
                                }

                                // Add static activities
                                const staticActivities = ["Mid-Party Snack", "Throne", "Arcade", "Winners Vault", "Food & Cake"];
                                const staticTimes = [snackTime, throneTime, arcadeTime, winnersTime, cakeTime];

                                const allActivities = dynamicActivities.map(a => a.activity).concat(staticActivities);
                                const allTimes = dynamicActivities.map(a => a.time).concat(staticTimes);

                                const columnCount = allActivities.length;
                                const colWidth = 100 / columnCount;

                                // First row: Activity names
                                for (const activity of allActivities) {
                                    activityRow.push(new docx.TableCell({
                                        children: [new docx.Paragraph({
                                            children: [new docx.TextRun({ text: activity, bold: true })],
                                            alignment: docx.AlignmentType.CENTER,
                                        })],
                                        width: { size: colWidth, type: "pct" },
                                        margins: { top: 100, bottom: 100, left: 100, right: 100 },
                                        verticalAlign: docx.VerticalAlign.CENTER
                                    }));

                                }

                                // Second row: Times
                                for (const time of allTimes) {
                                    timeRow.push(new docx.TableCell({
                                        children: [new docx.Paragraph({
                                            text: time,
                                            alignment: docx.AlignmentType.CENTER
                                        })],
                                        width: { size: colWidth, type: "pct" },
                                        margins: { top: 100, bottom: 100, left: 100, right: 100 },
                                        verticalAlign: docx.VerticalAlign.CENTER
                                    }));

                                }

                                return new docx.Table({
                                    rows: [
                                        new docx.TableRow({ children: activityRow }),
                                        new docx.TableRow({ children: timeRow })
                                    ],
                                    width: { size: 100, type: "pct" },
                                    borders: {
                                        top: { style: docx.BorderStyle.SINGLE, size: 4, color: "000000" },
                                        bottom: { style: docx.BorderStyle.SINGLE, size: 4, color: "000000" },
                                        left: { style: docx.BorderStyle.SINGLE, size: 4, color: "000000" },
                                        right: { style: docx.BorderStyle.SINGLE, size: 4, color: "000000" },
                                        insideHorizontal: { style: docx.BorderStyle.SINGLE, size: 4, color: "000000" },
                                        insideVertical: { style: docx.BorderStyle.SINGLE, size: 4, color: "000000" }
                                    }
                                });
                            })(),

                            new docx.Paragraph({ text: "", spacing: { after: 1 } }),

                            new docx.Table({
                                rows: [
                                    new docx.TableRow({
                                        children: [
                                            new docx.TableCell({
                                                children: [new docx.Paragraph({
                                                    children: [new docx.TextRun({ text: "Party Host Checklist", bold: true, size: 24 })],
                                                    spacing: { after: 150 }
                                                }),

                                                // Before the Party
                                                new docx.Paragraph({
                                                    children: [new docx.TextRun({ text: "Before the Party", bold: true })],
                                                    spacing: { after: 100 }
                                                }),
                                                ...[
                                                    "Uniform check, badge, apron, etc.",
                                                    "Run sheet filled out.",
                                                    "Booking sheet checked for all details.",
                                                    "Birthday card ready.",
                                                    "Table set up.",
                                                    "Lanyards & cards ready to go.",
                                                    "Lightweight bowling balls on ball return."
                                                ].map(item =>
                                                    new docx.Paragraph({
                                                        numbering: { reference: "checkbox-bullets", level: 0 },
                                                        indent: {
                                                            left: 720,       // Indent from left (0.5 inches)
                                                            hanging: 360     // Hanging indent so overflow aligns with text (0.25 inches)
                                                        },
                                                        children: [new docx.TextRun(item)],
                                                    })
                                                ),

                                                // During the Party
                                                new docx.Paragraph({
                                                    children: [new docx.TextRun({ text: "During the Party", bold: true })],
                                                    spacing: { before: 150, after: 100 }
                                                }),
                                                ...[
                                                    "Introduction, safety briefing, and lanyard.",
                                                ].map(item =>
                                                    new docx.Paragraph({
                                                        numbering: { reference: "checkbox-bullets", level: 0 },
                                                        indent: {
                                                            left: 720,       // Indent from left (0.5 inches)
                                                            hanging: 360     // Hanging indent so overflow aligns with text (0.25 inches)
                                                        },
                                                        children: [new docx.TextRun(item)]
                                                    })
                                                ),

                                                new docx.Paragraph({
                                                    numbering: { reference: "checkbox-bullets", level: 0 },
                                                    indent: {
                                                        left: 720,       // Indent from left (0.5 inches)
                                                        hanging: 360     // Hanging indent so overflow aligns with text (0.25 inches)
                                                    },
                                                    children: [
                                                        new docx.TextRun({ text: "Take food order and send to kitchen. " }),
                                                        new docx.TextRun({ text: "Do this during briefing when all the guests are still together.", bold: true })
                                                    ]
                                                }),

                                                ...[
                                                    "Group games and activities.",
                                                    "Give hi-fives and lots of encouragement.",
                                                    "Check-in with parents.",
                                                    "Complete headcount.",
                                                    "All extra activities completed (i.e. laser tag).",
                                                    "Throne and photos.",
                                                    "Winners vault.",
                                                    "Create remarkable moments for party guests.",
                                                    "Serve food/cake and keep party space clean."
                                                ].map(item =>
                                                    new docx.Paragraph({
                                                        numbering: { reference: "checkbox-bullets", level: 0 },
                                                        indent: {
                                                            left: 720,       // Indent from left (0.5 inches)
                                                            hanging: 360     // Hanging indent so overflow aligns with text (0.25 inches)
                                                        },
                                                        children: [new docx.TextRun(item)]
                                                    })
                                                ),

                                                // Thank You & Goodbye
                                                new docx.Paragraph({
                                                    children: [new docx.TextRun({ text: "Thank You & Goodbye", bold: true })],
                                                    spacing: { before: 150, after: 100 }
                                                }),
                                                ...[
                                                    "Ensure each guest is picked up and ticked off when collected.",
                                                    "Help birthday party parents with any presents or food pack up.",
                                                    "Hand out Thank You/Review Card."
                                                ].map(item =>
                                                    new docx.Paragraph({
                                                        numbering: { reference: "checkbox-bullets", level: 0 },
                                                        indent: {
                                                            left: 720,       // Indent from left (0.5 inches)
                                                            hanging: 360     // Hanging indent so overflow aligns with text (0.25 inches)
                                                        },
                                                        children: [new docx.TextRun(item)]
                                                    })
                                                ),

                                                // After the Party
                                                new docx.Paragraph({
                                                    children: [new docx.TextRun({ text: "After the Party", bold: true })],
                                                    spacing: { before: 150, after: 100 }
                                                }),
                                                ...[
                                                    "Clean down tables and chairs.",
                                                    "Spot clean floor.",
                                                    "Remove any rubbish.",
                                                    "Clear any dishes.",
                                                    "Check in with MOD/Coordinator for any other task."
                                                ].map(item =>
                                                    new docx.Paragraph({
                                                        numbering: { reference: "checkbox-bullets", level: 0 },
                                                        indent: {
                                                            left: 720,       // Indent from left (0.5 inches)
                                                            hanging: 360     // Hanging indent so overflow aligns with text (0.25 inches)
                                                        },
                                                        children: [new docx.TextRun(item)]
                                                    })
                                                ),
                                                ],
                                                borders: {
                                                    top: { style: docx.BorderStyle.NONE },
                                                    bottom: { style: docx.BorderStyle.NONE },
                                                    left: { style: docx.BorderStyle.NONE },
                                                    right: { style: docx.BorderStyle.SINGLE, size: 4, color: "000000" } // Middle dividing border
                                                },
                                                margins: { top: 100, bottom: 100, left: 100, right: 100 },
                                                width: { size: 53, type: "pct" }
                                            }),
                                            new docx.TableCell({
                                                children: [new docx.Paragraph({
                                                    children: [new docx.TextRun({ text: "Games & Challenge Ideas", bold: true, size: 24 })],
                                                    spacing: { after: 150 }
                                                }),
                                                new docx.Paragraph({
                                                    text: "Aim to play 5 games with every party.",
                                                    spacing: { before: 150, after: 150 }
                                                }),

                                                ...[
                                                    {
                                                        title: "Basketball Challenge",
                                                        desc: "Divide your party into teams and have them take turns shooting hoops."
                                                    },
                                                    {
                                                        title: "Air Hockey Challenge",
                                                        desc: "Divide party into two groups. Whoever scores the point stays on. Rotate through all your party guests."
                                                    },
                                                    {
                                                        title: "TikTok Dance",
                                                        desc: "Have the guest of honour choose their favourite trending TikTok dance and teach it to the group. Make sure to queue the song on Crowd DJ so they can dance along! Best used for teens."
                                                    },
                                                    {
                                                        title: "Speedy Bowler",
                                                        desc: "Have each lane throw a ball at the same time. Winner is the person whose ball hits the pins first."
                                                    },
                                                    {
                                                        title: "Bowling Under Your Legs",
                                                        desc: "Have guests turn around and throw the ball with two hands under their legs."
                                                    },
                                                    {
                                                        title: "Conga Line",
                                                        desc: "When moving between activities, have guests line up in a single file line, place their hands on the shoulders of the person in front and conga dance to their next destination! Best used for younger children."
                                                    },
                                                    {
                                                        title: "Laser Teams",
                                                        desc: "If playing in laser tag, have each team pick a fun team name and yell it out as a group!"
                                                    }
                                                ].flatMap(game => [
                                                    new docx.Paragraph({
                                                        children: [
                                                            new docx.TextRun({ text: game.title, bold: true })
                                                        ],
                                                        spacing: { after: 100 }
                                                    }),
                                                    new docx.Paragraph({
                                                        text: game.desc,
                                                        spacing: { after: 150 }
                                                    })
                                                ]),

                                                new docx.Paragraph({
                                                    children: [
                                                        new docx.TextRun({
                                                            text: "Not all teen parties will want to play games. Let the party take the lead and decide what games they will play!",
                                                            italics: true,
                                                            bold: true
                                                        })
                                                    ]
                                                }),
                                                ],
                                                margins: { top: 100, bottom: 100, left: 100, right: 100 },
                                                width: { size: 47, type: "pct" }
                                            })
                                        ]
                                    }),
                                ],
                                width: { size: 100, type: "pct" },
                                borders: {
                                    top: { size: 0, color: "FFFFFF" },
                                    bottom: { size: 0, color: "FFFFFF" },
                                    left: { size: 0, color: "FFFFFF" },
                                    right: { size: 0, color: "FFFFFF" },
                                    insideHorizontal: { size: 0, color: "000000" },
                                    insideVertical: { size: 0, color: "000000" }
                                }
                            }),
                        ]
                    }
                ]
            });
            const blob = await window.docx.Packer.toBlob(doc);
            return doc;
        }

        async function openMyForms() {
            const db = window.db;
            const { collection, getDocs, doc, deleteDoc } = await import('https://www.gstatic.com/firebasejs/11.9.1/firebase-firestore.js');

            try {
                const snapshot = await getDocs(collection(db, "runsheets"));
                const forms = snapshot.docs.map(doc => ({
                    id: doc.id,
                    ...doc.data()
                }));

                const listContainer = document.getElementById("form-list");
                listContainer.innerHTML = "";

                // ✅ Always open the modal
                document.getElementById("forms-modal").classList.remove("hidden");

                if (forms.length === 0) {
                    listContainer.innerHTML = `
                <div class="text-center text-gray-500 py-6">
                    <i class="fas fa-folder-open text-3xl mb-2 text-purple-300"></i>
                    <p class="text-sm">No saved forms found yet.</p>
                </div>`;
                    return;
                }

                forms.forEach(form => {
                    const wrapper = document.createElement("div");
                    wrapper.className = "flex justify-between items-center py-2 px-4 hover:bg-gray-50";

                    const info = document.createElement("div");
                    info.className = "flex flex-col";

                    const title = form.birthdayChild || form.host || "Unnamed";
                    const date = form.date || "No date";

                    info.innerHTML = `
                <span class="text-sm font-bold text-purple-800 truncate">${title}</span>
                <span class="text-xs text-gray-500">${date}</span>
            `;

                    const buttons = document.createElement("div");
                    buttons.className = "flex gap-1 shrink-0";

                    const loadBtn = document.createElement("button");
                    loadBtn.className = "px-2 py-1 bg-green-500 hover:bg-green-600 text-white text-xs rounded shadow";
                    loadBtn.innerHTML = '<i class="fas fa-upload"></i>';
                    loadBtn.title = "Load";
                    loadBtn.onclick = () => {
                        populateForm(form);
                        currentFormId = form.id;
                        closeMyForms();
                    };

                    const deleteBtn = document.createElement("button");
                    deleteBtn.className = "px-2 py-1 bg-red-500 hover:bg-red-600 text-white text-xs rounded shadow";
                    deleteBtn.innerHTML = '<i class="fas fa-trash"></i>';
                    deleteBtn.title = "Delete";
                    deleteBtn.onclick = async () => {
                        const confirmed = confirm("Are you sure you want to delete this form?");
                        if (!confirmed) return;

                        try {
                            await deleteDoc(doc(db, "runsheets", form.id));
                            showToast("Form deleted", "success");

                            if (currentFormId === form.id) {
                                handleNewForm(); // Clear current form
                            }

                            openMyForms(); // Refresh list
                        } catch (err) {
                            console.error("Error deleting form:", err);
                            showToast("Failed to delete form", "error");
                        }
                    };

                    buttons.appendChild(loadBtn);
                    buttons.appendChild(deleteBtn);

                    wrapper.appendChild(info);
                    wrapper.appendChild(buttons);
                    listContainer.appendChild(wrapper);
                });

            } catch (e) {
                console.error("Failed to load forms:", e);
                showToast("Could not load saved forms", "error");
            }
        }

        function closeMyForms() {
            document.getElementById("forms-modal").classList.add("hidden");
        }

        async function deleteForm(id) {
            const { doc, deleteDoc } = await import("https://www.gstatic.com/firebasejs/11.9.1/firebase-firestore.js");
            const db = window.db;

            if (confirm("Are you sure you want to delete this form?")) {
                try {
                    await deleteDoc(doc(db, "runsheets", id));
                    showToast("Form deleted", "success");

                    // 👇 Reset if this was the current form
                    if (currentFormId === id) {
                        handleNewForm(); // Clear the form and reset the save button
                    }

                    openMyForms(); // Refresh the list
                } catch (e) {
                    console.error("Delete failed:", e);
                    showToast("Failed to delete form", "error");
                }
            }
        }

        function handleNewForm() {
            // Clear all inputs
            document.getElementById("host").value = "";
            document.getElementById("date").value = "";
            document.getElementById("birthday-child").value = "";
            document.getElementById("parent-name").value = "";
            document.getElementById("age").value = "";
            document.getElementById("guests").value = "";
            document.getElementById("partypkg").selectedIndex = 0;
            document.getElementById("gift").selectedIndex = 0;

            // Uncheck all food checkboxes and hide associated number inputs
            document.querySelectorAll('input[name="food"]').forEach(cb => {
                cb.checked = false;
                const input = cb.closest('label').parentElement.querySelector('input[type="number"]');
                input.classList.add('hidden');
                input.value = '';
            });

            // Reset extra activity and times
            document.getElementById("extra-activity-1").selectedIndex = 0;
            document.getElementById("extra-activity-2").selectedIndex = 0;
            document.getElementById("extra-time-1").value = "";
            document.getElementById("extra-time-2").value = "";
            document.getElementById("snack-time").value = "";
            document.getElementById("throne-time").value = "";
            document.getElementById("arcade-time").value = "";
            document.getElementById("winners-time").value = "";
            document.getElementById("cake-time").value = "";

            document.getElementById("form-title").textContent = "New Form";

            // Reset state
            currentFormId = null;
            document.getElementById("save-btn").innerHTML = `<i class="fas fa-save text-lg"></i> Save Form`;

            // Reset package logic
            document.getElementById("partypkg").dispatchEvent(new Event("change"));

            window.scrollTo({ top: 0, behavior: "smooth" });
        }

        function showToast(message, type = "info") {
            const container = document.getElementById("toast-container");

            const toast = document.createElement("div");
            toast.className = `flex items-center gap-3 px-4 py-2 rounded-lg shadow-lg text-white text-sm animate-slide-in ${type === "success" ? "bg-green-600" : type === "error" ? "bg-red-600" : "bg-gray-800"}`;
            toast.innerHTML = `<i class="fas ${type === "success" ? "fa-check-circle" : type === "error" ? "fa-exclamation-circle" : "fa-info-circle"} text-white"></i><span>${message}</span>`;

            container.appendChild(toast);

            setTimeout(() => {
                toast.classList.add("opacity-0");
                setTimeout(() => container.removeChild(toast), 300);
            }, 3000);
        }
    </script>

    <div id="forms-modal"
        class="fixed inset-0 z-50 hidden flex items-center justify-center bg-black bg-opacity-60 transition-opacity duration-300">

        <!-- Modal card -->
        <div
            class="bg-white rounded-xl shadow-2xl w-full max-w-3xl mx-auto p-6 relative text-gray-800 h-[500px] flex flex-col">

            <h2 class="text-2xl font-bold text-center mb-4 flex items-center justify-center gap-2 text-purple-700">
                <i class="fas fa-folder-open"></i> Saved Run Sheets
            </h2>

            <!-- Scrollable form list takes remaining space -->
            <div id="form-list" class="divide-y divide-gray-200 overflow-y-auto px-1 text-sm flex-1">
                <!-- Forms will be inserted here -->
            </div>

            <!-- Close button -->
            <button onclick="closeMyForms()"
                class="absolute top-4 right-4 text-gray-400 hover:text-gray-700 transition">
                <i class="fas fa-times text-xl"></i>
            </button>
        </div>
    </div>

    <!-- Toast Notification Container -->
    <div id="toast-container" class="fixed top-6 right-6 space-y-2 z-50"></div>

</body>

</html>
